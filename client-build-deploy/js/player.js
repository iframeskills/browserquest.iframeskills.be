define(["character","exceptions"],function(a,b){var c=a.extend({MAX_LEVEL:10,init:function(a,b,c){this._super(a,c),this.name=b,this.nameOffsetY=-10,this.spriteName="clotharmor",this.weaponName="sword1",this.isLootMoving=!1,this.isSwitchingWeapon=!0},loot:function(a){if(a){var c,d,e,f;this.currentArmorSprite?f=this.currentArmorSprite.name:f=this.spriteName,a.type==="armor"?(c=Types.getArmorRank(a.kind),d=Types.getArmorRank(Types.getKindFromString(f)),e="You are wearing a better armor"):a.type==="weapon"&&(c=Types.getWeaponRank(a.kind),d=Types.getWeaponRank(Types.getKindFromString(this.weaponName)),e="You are wielding a better weapon");if(c&&d){if(c===d)throw new b.LootException("You already have this "+a.type);if(c<=d)throw new b.LootException(e)}log.info("Player "+this.id+" has looted "+a.id),Types.isArmor(a.kind)&&this.invincible&&this.stopInvincibility(),a.onLoot(this)}},isMovingToLoot:function(){return this.isLootMoving},getSpriteName:function(){return this.spriteName},setSpriteName:function(a){this.spriteName=a},getArmorName:function(){var a=this.getArmorSprite();return a.id},getArmorSprite:function(){return this.invincible?this.currentArmorSprite:this.sprite},getWeaponName:function(){return this.weaponName},setWeaponName:function(a){this.weaponName=a},hasWeapon:function(){return this.weaponName!==null},switchWeapon:function(a){var b=14,c=!1,d=this,e=function(){c=!c;return c};if(a!==this.getWeaponName()){this.isSwitchingWeapon&&clearInterval(f),this.switchingWeapon=!0;var f=setInterval(function(){e()?d.setWeaponName(a):d.setWeaponName(null),b-=1,b===1&&(clearInterval(f),d.switchingWeapon=!1,d.switch_callback&&d.switch_callback())},90)}},switchArmor:function(a){var b=14,c=!1,d=this,e=function(){c=!c;return c};if(a&&a.id!==this.getSpriteName()){this.isSwitchingArmor&&clearInterval(f),this.isSwitchingArmor=!0,d.setSprite(a),d.setSpriteName(a.id);var f=setInterval(function(){d.setVisible(e()),b-=1,b===1&&(clearInterval(f),d.isSwitchingArmor=!1,d.switch_callback&&d.switch_callback())},90)}},onArmorLoot:function(a){this.armorloot_callback=a},onSwitchItem:function(a){this.switch_callback=a},onInvincible:function(a){this.invincible_callback=a},startInvincibility:function(){var a=this;this.invincible?this.invincibleTimeout&&clearTimeout(this.invincibleTimeout):(this.currentArmorSprite=this.getSprite(),this.invincible=!0,this.invincible_callback()),this.invincibleTimeout=setTimeout(function(){a.stopInvincibility(),a.idle()},15e3)},stopInvincibility:function(){this.invincible_callback(),this.invincible=!1,this.currentArmorSprite&&(this.setSprite(this.currentArmorSprite),this.setSpriteName(this.currentArmorSprite.id),this.currentArmorSprite=null),this.invincibleTimeout&&clearTimeout(this.invincibleTimeout)}});return c})