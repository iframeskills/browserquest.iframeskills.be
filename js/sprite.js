define(["jquery","animation","sprites"],function(a,b,c){var d=Class.extend({init:function(a,b){this.name=a,this.scale=b,this.isLoaded=!1,this.offsetX=0,this.offsetY=0,this.loadJSON(c[a])},loadJSON:function(a){this.id=a.id,this.filepath="img/"+this.scale+"/"+this.id+".png",this.animationData=a.animations,this.width=a.width,this.height=a.height,this.offsetX=a.offset_x!==undefined?a.offset_x:-16,this.offsetY=a.offset_y!==undefined?a.offset_y:-16,this.load()},load:function(){var a=this;this.image=new Image,this.image.src=this.filepath,this.image.onload=function(){a.isLoaded=!0,a.onload_func&&a.onload_func()}},createAnimations:function(){var a={};for(var c in this.animationData){var d=this.animationData[c];a[c]=new b(c,d.length,d.row,this.width,this.height)}return a},createHurtSprite:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=this.image.width,d=this.image.height,e,f;a.width=c,a.height=d,b.drawImage(this.image,0,0,c,d);try{e=b.getImageData(0,0,c,d),f=e.data;for(var g=0;g<f.length;g+=4)f[g]=255,f[g+1]=f[g+2]=75;e.data=f,b.putImageData(e,0,0),this.whiteSprite={image:a,isLoaded:!0,offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height}}catch(h){log.error("Error getting image data for sprite : "+this.name)}},getHurtSprite:function(){return this.whiteSprite},createSilhouette:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=this.image.width,d=this.image.height,e,f,g;a.width=c,a.height=d,b.drawImage(this.image,0,0,c,d),g=b.getImageData(0,0,c,d).data,f=b.getImageData(0,0,c,d),fdata=f.data;var h=function(a,b){return(c*(b-1)+a-1)*4},i=function(a){var b,d;a=a/4+1,b=a%c,d=(a-b)/c+1;return{x:b,y:d}},j=function(a){var b=i(a);return b.x<c&&!k(h(b.x+1,b.y))?!0:b.x>1&&!k(h(b.x-1,b.y))?!0:b.y<d&&!k(h(b.x,b.y+1))?!0:b.y>1&&!k(h(b.x,b.y-1))?!0:!1},k=function(a){return a<0||a>=g.length?!0:g[a]===0&&g[a+1]===0&&g[a+2]===0&&g[a+3]===0};for(var l=0;l<g.length;l+=4)k(l)&&j(l)&&(fdata[l]=fdata[l+1]=255,fdata[l+2]=150,fdata[l+3]=150);f.data=fdata,b.putImageData(f,0,0),this.silhouetteSprite={image:a,isLoaded:!0,offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height}}});return d})